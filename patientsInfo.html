<html>
    <head>
        <title>확진자 정보</title>

        <style>
            #list {
                width: auto;
                height: 100%;
                float: left;
            }

            #map {
                width: auto;
                height: 100%;
            }

            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>

        <!-- jquery -->
        <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="crossorigin="anonymous"></script>

        <!-- CORS error 문제 때문에 json을 js 파일로 읽어옴 -->
        <script src="crawling/patientsInfo.js"></script>
        <script src="crawling/patientsRoute.js"></script>
    </head>
    <body>
        <div id="list"></div>
        <div id="map"></div>

        <script>
            var list = function(data) {
                for(p in data) {
                    // { "idx": "60", "age": "40", "gender": "여성", "address": "송정동" }
                    document.getElementById('list').innerHTML += data[p]["idx"] + "번째 확진자: " + data[p]["age"] + "대 " + data[p]["gender"] + ", " + data[p]["address"] + "<br>";
                }
            }
            list(patientsInfo);
        
            function initMap() {

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 15,
                    center: { lat: 36.1195, lng: 128.3446 } // gumi city
                });

                patientsInfo.forEach(function(element) {
                    
                    var loc = {lat: parseFloat(element.lat), lng: parseFloat(element.lng)};
                    var marker = new google.maps.Marker({
                        position: loc,
                        map: map,
                        title: element.idx + '번 확진자, ' + element.age + '대, ' + element.gender + ', ' + element.address,
                        label: (element.idx).toString()
                    });
                    
                    var contents = '';
                    for(var idx in patientsRoute) {
                        if(patientsRoute[idx]['index'] != element.idx) continue;
                        contents += patientsRoute[idx]['index'] + '번 확진자<br>';
                        for(var idx2 in patientsRoute[idx]['list']) {
                            contents += patientsRoute[idx]['list'][idx2]['date'] + ': ' + patientsRoute[idx]['list'][idx2]['route'] + '<br>';
                        }
                        break;
                    }

                    var infowindow = new google.maps.InfoWindow({
                        content: contents
                    });

                    marker.addListener('click', function() {
                        infowindow.open(map, marker);
                    });

                });
            }

        </script>
        <!-- map API -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmVnIOsg37a2A31OqbtYrbqadG8y60Dq4&callback=initMap" async defer></script>
    </body>
</html>